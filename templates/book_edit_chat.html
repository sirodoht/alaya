{% extends "layout.html" %}

{% block title %}Edit in Chat - {{ book.title }}{% endblock title %}

{% block content %}
<section>
    <div class="page-row">
        <div class="page-header">
            <h1>Edit in Chat</h1>
            <p>{{ book.title }}{% if let Some(author) = book.author %} by {{ author }}{% endif %}</p>
        </div>
    </div>

    <div class="page-row">
        <div class="page-content">
            <span class="page-label">Title</span>
            <span class="page-value">{{ book.title }}</span>
        </div>
    </div>
    <div class="page-row">
        <div class="page-content">
            <span class="page-label">Author</span>
            <span class="page-value">{% if let Some(author) = book.author %}{{ author }}{% else %}not set{% endif %}</span>
        </div>
    </div>
    <div class="page-row">
        <div class="page-content">
            <span class="page-label">ISBN</span>
            <span class="page-value">{% if let Some(isbn) = book.isbn %}{{ isbn }}{% else %}not set{% endif %}</span>
        </div>
    </div>
    <div class="page-row">
        <div class="page-content">
            <span class="page-label">Year</span>
            <span class="page-value">{% if let Some(year) = book.publication_year %}{{ year }}{% else %}not set{% endif %}</span>
        </div>
    </div>

    {% if let Some(error) = error_message %}
    <div class="page-row">
        <div class="page-error">{{ error }}</div>
    </div>
    {% endif %}

    {% if let Some(result) = edit_result %}
    <div class="page-row">
        <div class="page-header">
            <h1>Suggested Changes</h1>
        </div>
    </div>
    <div class="page-row">
        <div class="page-content">
            <span class="page-label">Title</span>
            <span class="page-value {% if result.title != book.title %}page-value-changed{% endif %}">{{ result.title }}</span>
        </div>
    </div>
    <div class="page-row">
        <div class="page-content">
            <span class="page-label">Author</span>
            <span class="page-value {% if result.author != book.author %}page-value-changed{% endif %}">{% if let Some(author) = result.author %}{{ author }}{% else %}not set{% endif %}</span>
        </div>
    </div>
    <div class="page-row">
        <div class="page-content">
            <span class="page-label">ISBN</span>
            <span class="page-value {% if result.isbn != book.isbn %}page-value-changed{% endif %}">{% if let Some(isbn) = result.isbn %}{{ isbn }}{% else %}not set{% endif %}</span>
        </div>
    </div>
    <div class="page-row">
        <div class="page-content">
            <span class="page-label">Year</span>
            <span class="page-value {% if result.publication_year != book.publication_year %}page-value-changed{% endif %}">{% if let Some(year) = result.publication_year %}{{ year }}{% else %}not set{% endif %}</span>
        </div>
    </div>
    <div class="page-row">
        <div class="page-content page-actions">
            <form method="post" action="/books/{{ book.id }}/edit-chat/apply">
                <input type="hidden" name="title" value="{{ result.title }}">
                <input type="hidden" name="author" value="{% if let Some(author) = result.author %}{{ author }}{% endif %}">
                <input type="hidden" name="isbn" value="{% if let Some(isbn) = result.isbn %}{{ isbn }}{% endif %}">
                <input type="hidden" name="publication_year" value="{% if let Some(year) = result.publication_year %}{{ year }}{% endif %}">
                <button type="submit" class="btn">save</button>
            </form>
            <a href="/books/{{ book.id }}/edit-chat" class="btn">cancel</a>
        </div>
    </div>
    {% else %}
    <form method="post" action="/books/{{ book.id }}/edit-chat">
        <div class="page-row">
            <div class="page-content">
                <label for="instruction">instruction</label>
                <input type="text" name="instruction" id="instruction" placeholder="eg. remove the subtitle, fix author name...">
            </div>
        </div>
        <div class="page-row">
            <div class="page-content">
                <label for="model">robot</label>
                <select id="model" name="model">
                    <option value="gpt-5.1">gpt-5.1</option>
                    <option value="gpt-5-nano">gpt-5-nano</option>
                    <option value="gpt-5-mini">gpt-5-mini</option>
                </select>
            </div>
        </div>
        <div class="page-row">
            <div class="page-content page-actions">
                <a href="/books/{{ book.id }}" class="btn">cancel</a>
                <input type="submit" class="btn" value="message">
            </div>
        </div>
    </form>
    {% endif %}
</section>
{% endblock content %}
